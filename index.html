<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MTK Coin Miner - Complete Game</title>
    <style>
        :root {
            --primary: #f8c555;
            --primary-dark: #e6b142;
            --success: #2ed573;
            --warning: #ffa502;
            --error: #ff4757;
            --info: #1e90ff;
            --dark-bg: #1a1a2e;
            --darker-bg: #16213e;
            --card-bg: rgba(0, 0, 0, 0.7);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; display: grid; grid-template-columns: 1fr 400px; gap: 20px; }
        .section { background: var(--card-bg); border-radius: 15px; padding: 20px; margin-bottom: 20px; }
        h1 { text-align: center; margin-bottom: 20px; color: var(--primary); }
        h2 { color: var(--primary); margin-bottom: 15px; }
        h3 { color: var(--primary); margin: 10px 0; }
        .game-container { background: var(--darker-bg); border: 3px solid var(--primary); border-radius: 10px; overflow: hidden; margin-bottom: 20px; aspect-ratio: 16/9; }
        #gameCanvas { width: 100%; height: 100%; display: block; }
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin: 15px 0; }
        .stat-card { background: rgba(248,197,85,0.15); border-radius: 8px; padding: 15px; text-align: center; }
        .stat-value { font-size: 24px; font-weight: bold; color: var(--primary); }
        .stat-label { font-size: 12px; color: #aaa; }
        .controls-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 15px; }
        .btn { background: linear-gradient(45deg, var(--primary), var(--primary-dark)); color: #000; border: none; padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .btn-success { background: linear-gradient(45deg, var(--success), #25c164); }
        .btn-warning { background: linear-gradient(45deg, var(--warning), #e59400); }
        .btn-info { background: linear-gradient(45deg, var(--info), #187bcd); }
        .wallet-card { background: rgba(248,197,85,0.1); border: 2px solid var(--primary); border-radius: 10px; padding: 15px; margin: 15px 0; }
        .info-item { display: flex; justify-content: space-between; margin: 10px 0; padding: 8px; background: rgba(255,255,255,0.05); border-radius: 5px; }
        .label { color: var(--primary); font-weight: bold; }
        .value { font-family: monospace; }
        input { padding: 10px; border-radius: 5px; border: 2px solid var(--primary); background: rgba(255,255,255,0.05); color: white; width: 100%; margin: 5px 0; }
        .faucet-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin: 15px 0; }
        .faucet-card { background: rgba(46,213,115,0.1); border: 2px solid var(--success); border-radius: 10px; padding: 15px; }
        .notification { position: fixed; top: 20px; right: 20px; padding: 15px 25px; background: var(--primary); color: #000; border-radius: 8px; font-weight: bold; transform: translateX(150%); transition: transform 0.3s; z-index: 1000; }
        .notification.show { transform: translateX(0); }
        .hidden { display: none; }
        .mine-spot { position: absolute; width: 20px; height: 20px; background: var(--primary); border-radius: 50%; animation: pulse 2s infinite; }
        @keyframes pulse { 
            0% { transform: scale(1); opacity: 0.8; } 
            50% { transform: scale(1.2); opacity: 1; } 
            100% { transform: scale(1); opacity: 0.8; } 
        }
    </style>
</head>
<body>
    <h1>‚õèÔ∏è MTK Coin Miner - Complete Game</h1>
    
    <div class="container">
        <!-- LEFT COLUMN: GAME -->
        <div>
            <div class="section">
                <h2>üéÆ Mining Game</h2>
                <div class="game-container">
                    <canvas id="gameCanvas"></canvas>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="score">0</div>
                        <div class="stat-label">MTK Mined</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="multiplier">1x</div>
                        <div class="stat-label">Mining Power</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="miners">1</div>
                        <div class="stat-label">Active Miners</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="speed">1.0</div>
                        <div class="stat-label">Mining Speed</div>
                    </div>
                </div>
                
                <div class="controls-grid">
                    <button class="btn" onclick="upgradeMiningPower()">‚¨ÜÔ∏è Upgrade Power (100 MTK)</button>
                    <button class="btn" onclick="buyMiner()">üë∑ Buy Miner (500 MTK)</button>
                    <button class="btn" onclick="upgradeSpeed()">‚ö° Increase Speed (250 MTK)</button>
                    <button class="btn btn-success" onclick="claimTokens()">üí∞ Claim MTK Tokens</button>
                </div>
            </div>
            
            <div class="section">
                <h2>üìä Game Statistics</h2>
                <div class="wallet-card">
                    <div class="info-item">
                        <span class="label">Total Mined</span>
                        <span class="value" id="totalMined">0 MTK</span>
                    </div>
                    <div class="info-item">
                        <span class="label">Total Claimed</span>
                        <span class="value" id="totalClaimed">0 MTK</span>
                    </div>
                    <div class="info-item">
                        <span class="label">Total Withdrawn</span>
                        <span class="value" id="totalWithdrawn">0 MTK</span>
                    </div>
                    <div class="info-item">
                        <span class="label">Game Balance</span>
                        <span class="value" id="gameBalance">0 MTK</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- RIGHT COLUMN: WALLET & FAUCETS -->
        <div>
            <div class="section">
                <h2>üëõ Wallet & Blockchain</h2>
                
                <div class="wallet-card">
                    <div class="info-item">
                        <span class="label">Status</span>
                        <span class="value" id="walletStatus">Not Connected</span>
                    </div>
                    <div class="info-item">
                        <span class="label">Account</span>
                        <span class="value" id="accountAddress">-</span>
                    </div>
                    <div class="info-item">
                        <span class="label">Network</span>
                        <span class="value" id="network">-</span>
                    </div>
                    <div class="info-item">
                        <span class="label">ETH Balance</span>
                        <span class="value" id="ethBalance">0 ETH</span>
                    </div>
                    <button class="btn" onclick="connectWallet()" id="connectBtn" style="width: 100%; margin-top: 10px;">
                        üîó Connect MetaMask
                    </button>
                </div>
                
                <!-- Claim Section -->
                <div class="wallet-card" style="background: rgba(46,213,115,0.1); border-color: var(--success);">
                    <h3 style="color: var(--success);">üí∞ Claim Game Tokens</h3>
                    <div class="info-item">
                        <span class="label">Claimable</span>
                        <span class="value" id="claimableBalance">0 MTK</span>
                    </div>
                    <button class="btn btn-success" onclick="estimateClaimGas()" style="width: 100%; margin-top: 10px;">
                        üí∞ Claim to Wallet
                    </button>
                </div>
                
                <!-- Withdrawal Section -->
                <div class="wallet-card" style="background: rgba(255,159,67,0.1); border-color: var(--warning);">
                    <h3 style="color: var(--warning);">üè¶ Withdraw Tokens</h3>
                    <div class="info-item">
                        <span class="label">Wallet Balance</span>
                        <span class="value" id="walletTokenBalance">0 MTK</span>
                    </div>
                    <input type="number" id="withdrawAmount" placeholder="Amount to withdraw" value="10" min="1">
                    <input type="text" id="recipientAddress" placeholder="Recipient address (0x...)" value="0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266">
                    <button class="btn btn-warning" onclick="estimateWithdrawGas()" style="width: 100%; margin-top: 10px;">
                        üè¶ Withdraw Tokens
                    </button>
                </div>
            </div>
            
            <!-- FAUCETS SECTION -->
            <div class="section">
                <h2>üöÄ Get Real Test Tokens</h2>
                
                <!-- ETH Faucets -->
                <div class="faucet-card">
                    <h3>‚õΩ Get Sepolia ETH (Free)</h3>
                    <p style="color: #aaa; margin: 10px 0; font-size: 14px;">Need ETH for gas fees</p>
                    <button class="btn btn-info" onclick="window.open('https://sepoliafaucet.com', '_blank')" style="width: 100%; margin: 5px 0;">
                        üöÄ Alchemy Faucet (0.5 ETH/day)
                    </button>
                    <button class="btn btn-info" onclick="window.open('https://www.infura.io/faucet/sepolia', '_blank')" style="width: 100%; margin: 5px 0;">
                        üíß Infura Faucet
                    </button>
                </div>
                
                <!-- Token Faucets -->
                <div class="faucet-grid">
                    <div class="faucet-card">
                        <h3>ü™ô Get UNI Tokens</h3>
                        <p style="color: #aaa; font-size: 12px;">Uniswap token</p>
                        <button class="btn btn-success" onclick="getUniTokens()" style="width: 100%; margin-top: 10px;">
                            üéÅ Get UNI
                        </button>
                    </div>
                    
                    <div class="faucet-card">
                        <h3>üîó Get LINK Tokens</h3>
                        <p style="color: #aaa; font-size: 12px;">Chainlink token</p>
                        <button class="btn btn-success" onclick="getLinkTokens()" style="width: 100%; margin-top: 10px;">
                            üéÅ Get LINK
                        </button>
                    </div>
                </div>
                
                <div class="wallet-card" style="margin-top: 15px;">
                    <h3>üìù How to Get Tokens:</h3>
                    <ol style="margin: 10px 0 0 20px; color: #aaa; font-size: 14px;">
                        <li>Get Sepolia ETH from faucet</li>
                        <li>Go to Uniswap: app.uniswap.org</li>
                        <li>Swap ETH for UNI/LINK tokens</li>
                        <li>Use tokens to test withdrawals</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Notifications -->
    <div class="notification" id="notification"></div>

    <script>
        // ============================================
        // GAME VARIABLES
        // ============================================
        let score = 0;
        let miningPower = 1;
        let miners = 1;
        let miningSpeed = 1.0;
        let gameInterval;
        let mineSpots = [];
        let totalMined = 0;
        let totalClaimed = 0;
        let totalWithdrawn = 0;
        let claimableBalance = 0;
        let walletTokenBalance = 0;
        
        // ============================================
        // BLOCKCHAIN VARIABLES
        // ============================================
        let web3 = null;
        let userAccount = null;
        let connected = false;
        let selectedToken = {
            address: '0x1f9840a85d5aF5bf1D1762F925BDADdC4201F984', // UNI token
            name: 'Uniswap',
            symbol: 'UNI',
            decimals: 18
        };

        // ============================================
        // GAME FUNCTIONS
        // ============================================
        function initGame() {
            const canvas = document.getElementById('gameCanvas');
            const container = canvas.parentElement;
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
            
            createMineSpots(canvas);
            gameInterval = setInterval(() => updateGame(canvas), 1000 / miningSpeed);
            updateGameUI();
        }

        function createMineSpots(canvas) {
            mineSpots = [];
            for (let i = 0; i < 5; i++) {
                mineSpots.push({
                    x: Math.random() * (canvas.width - 40) + 20,
                    y: Math.random() * (canvas.height - 40) + 20,
                    active: true
                });
            }
        }

        function updateGame(canvas) {
            const ctx = canvas.getContext('2d');
            
            // Draw background
            ctx.fillStyle = '#16213e';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Draw mine spots
            mineSpots.forEach(spot => {
                if (spot.active) {
                    ctx.fillStyle = '#f8c555';
                    ctx.beginPath();
                    ctx.arc(spot.x, spot.y, 10, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Glow effect
                    ctx.shadowColor = '#f8c555';
                    ctx.shadowBlur = 20;
                    ctx.beginPath();
                    ctx.arc(spot.x, spot.y, 5, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.shadowBlur = 0;
                }
            });
            
            // Auto mining
            mineSpots.forEach(spot => {
                if (spot.active && Math.random() < 0.3) {
                    const mined = miningPower * miners;
                    score += mined;
                    totalMined += mined;
                    claimableBalance += mined;
                    updateGameUI();
                    
                    // Show particle effect
                    showParticle(spot.x, spot.y);
                }
            });
        }

        function showParticle(x, y) {
            const particle = document.createElement('div');
            particle.className = 'mine-spot';
            particle.style.left = (x - 10) + 'px';
            particle.style.top = (y - 10) + 'px';
            document.querySelector('.game-container').appendChild(particle);
            
            setTimeout(() => particle.remove(), 1000);
        }

        // Canvas click handler
        const canvas = document.getElementById('gameCanvas');
        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            mineSpots.forEach(spot => {
                const distance = Math.sqrt((x - spot.x) ** 2 + (y - spot.y) ** 2);
                if (distance < 20 && spot.active) {
                    const minedAmount = miningPower * 10;
                    score += minedAmount;
                    totalMined += minedAmount;
                    claimableBalance += minedAmount;
                    
                    spot.active = false;
                    setTimeout(() => {
                        spot.active = true;
                        spot.x = Math.random() * (canvas.width - 40) + 20;
                        spot.y = Math.random() * (canvas.height - 40) + 20;
                    }, 1000);
                    
                    updateGameUI();
                    showNotification(`+${minedAmount} MTK mined!`, 'success');
                    
                    // Show multiple particles
                    for (let i = 0; i < 3; i++) {
                        setTimeout(() => {
                            showParticle(spot.x + Math.random() * 30 - 15, spot.y + Math.random() * 30 - 15);
                        }, i * 100);
                    }
                }
            });
        });

        function upgradeMiningPower() {
            if (score >= 100) {
                score -= 100;
                miningPower++;
                updateGameUI();
                showNotification('Mining power upgraded!', 'success');
            } else {
                showNotification('Not enough MTK!', 'error');
            }
        }

        function buyMiner() {
            if (score >= 500) {
                score -= 500;
                miners++;
                updateGameUI();
                showNotification('New miner purchased!', 'success');
            } else {
                showNotification('Not enough MTK!', 'error');
            }
        }

        function upgradeSpeed() {
            if (score >= 250) {
                score -= 250;
                miningSpeed += 0.5;
                clearInterval(gameInterval);
                gameInterval = setInterval(() => updateGame(canvas), 1000 / miningSpeed);
                updateGameUI();
                showNotification('Mining speed increased!', 'success');
            } else {
                showNotification('Not enough MTK!', 'error');
            }
        }

        function updateGameUI() {
            document.getElementById('score').textContent = score;
            document.getElementById('multiplier').textContent = `${miningPower}x`;
            document.getElementById('miners').textContent = miners;
            document.getElementById('speed').textContent = miningSpeed.toFixed(1);
            document.getElementById('totalMined').textContent = `${totalMined} MTK`;
            document.getElementById('totalClaimed').textContent = `${totalClaimed} MTK`;
            document.getElementById('totalWithdrawn').textContent = `${totalWithdrawn} MTK`;
            document.getElementById('gameBalance').textContent = `${score} MTK`;
            document.getElementById('claimableBalance').textContent = `${claimableBalance} MTK`;
            document.getElementById('walletTokenBalance').textContent = `${walletTokenBalance} MTK`;
        }

        // ============================================
        // CLAIMING FUNCTIONS
        // ============================================
        async function claimTokens() {
            if (claimableBalance <= 0) {
                showNotification('No tokens to claim!', 'error');
                return;
            }
            
            // In real implementation, this would mint tokens on blockchain
            // For demo, we simulate claiming
            
            const claimedAmount = claimableBalance;
            walletTokenBalance += claimedAmount;
            totalClaimed += claimedAmount;
            claimableBalance = 0;
            score = 0;
            
            updateGameUI();
            showNotification(`‚úÖ Claimed ${claimedAmount} MTK to wallet!`, 'success');
        }

        async function estimateClaimGas() {
            if (!connected) {
                showNotification('Connect wallet first!', 'error');
                return;
            }
            
            if (claimableBalance <= 0) {
                showNotification('No tokens to claim!', 'error');
                return;
            }
            
            showNotification('Gas estimation would show here', 'info');
        }

        // ============================================
        // WITHDRAWAL FUNCTIONS
        // ============================================
        async function estimateWithdrawGas() {
            if (!connected || !web3) {
                showNotification('Connect wallet first!', 'error');
                return;
            }
            
            const amount = parseFloat(document.getElementById('withdrawAmount').value);
            const recipient = document.getElementById('recipientAddress').value.trim();
            
            if (!amount || amount <= 0) {
                showNotification('Enter valid amount', 'error');
                return;
            }
            
            if (!recipient || !web3.utils.isAddress(recipient)) {
                showNotification('Enter valid address', 'error');
                return;
            }
            
            if (walletTokenBalance < amount) {
                showNotification(`Insufficient balance! You have ${walletTokenBalance} MTK`, 'error');
                return;
            }
            
            // In real implementation, this would estimate gas
            showNotification(`Would withdraw ${amount} MTK to ${recipient.substring(0, 10)}...`, 'info');
        }

        // ============================================
        // WALLET CONNECTION
        // ============================================
        async function connectWallet() {
            try {
                if (typeof window.ethereum === 'undefined') {
                    showNotification('Install MetaMask first!', 'error');
                    return;
                }

                const accounts = await window.ethereum.request({ 
                    method: 'eth_requestAccounts' 
                });
                
                if (accounts.length === 0) {
                    showNotification('Unlock MetaMask!', 'error');
                    return;
                }
                
                userAccount = accounts[0];
                web3 = new Web3(window.ethereum);
                
                const chainId = await web3.eth.getChainId();
                const isSepolia = chainId === 11155111;
                
                // Update UI
                document.getElementById('walletStatus').textContent = 'Connected ‚úì';
                document.getElementById('accountAddress').textContent = 
                    userAccount.substring(0, 6) + '...' + userAccount.substring(38);
                document.getElementById('network').textContent = 
                    isSepolia ? 'Sepolia Testnet ‚úì' : `Network ${chainId}`;
                
                document.getElementById('connectBtn').textContent = '‚úÖ Connected';
                document.getElementById('connectBtn').disabled = true;
                
                connected = true;
                
                // Get ETH balance
                await updateEthBalance();
                
                // Start game if not already started
                if (!gameInterval) {
                    initGame();
                }
                
                showNotification('Wallet connected!', 'success');
                
                if (!isSepolia) {
                    showNotification('Switch to Sepolia for test tokens', 'warning');
                }
                
            } catch (error) {
                console.error('Connection error:', error);
                showNotification('Connection failed', 'error');
            }
        }

        async function updateEthBalance() {
            if (!connected || !web3) return;
            
            try {
                const balance = await web3.eth.getBalance(userAccount);
                const ethFormatted = web3.utils.fromWei(balance, 'ether');
                document.getElementById('ethBalance').textContent = 
                    `${parseFloat(ethFormatted).toFixed(4)} ETH`;
            } catch (error) {
                console.error('Balance error:', error);
            }
        }

        // ============================================
        // FAUCET FUNCTIONS
        // ============================================
        function getUniTokens() {
            if (!connected) {
                showNotification('Connect wallet first!', 'error');
                return;
            }
            
            showNotification('üéÅ To get UNI tokens: 1. Get ETH from faucet 2. Go to Uniswap 3. Swap ETH for UNI', 'info');
            window.open('https://app.uniswap.org/swap', '_blank');
        }

        function getLinkTokens() {
            if (!connected) {
                showNotification('Connect wallet first!', 'error');
                return;
            }
            
            showNotification('üîó Opening Chainlink faucet...', 'info');
            window.open('https://faucets.chain.link/sepolia', '_blank');
        }

        // ============================================
        // UTILITY FUNCTIONS
        // ============================================
        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = 'notification';
            
            const colors = {
                'error': '#ff4757',
                'success': '#2ed573',
                'warning': '#ffa502',
                'info': '#1e90ff'
            };
            
            notification.style.background = colors[type] || '#f8c555';
            
            setTimeout(() => notification.classList.add('show'), 10);
            setTimeout(() => notification.classList.remove('show'), 3000);
        }

        // ============================================
        // INITIALIZE
        // ============================================
        window.onload = function() {
            // Start game immediately
            initGame();
            
            // Check if already connected to MetaMask
            if (typeof window.ethereum !== 'undefined') {
                window.ethereum.request({ method: 'eth_accounts' })
                    .then(accounts => {
                        if (accounts.length > 0) {
                            // Auto-connect
                            userAccount = accounts[0];
                            web3 = new Web3(window.ethereum);
                            connected = true;
                            
                            document.getElementById('walletStatus').textContent = 'Connected ‚úì';
                            document.getElementById('accountAddress').textContent = 
                                userAccount.substring(0, 6) + '...' + userAccount.substring(38);
                            document.getElementById('connectBtn').textContent = '‚úÖ Connected';
                            document.getElementById('connectBtn').disabled = true;
                            
                            updateEthBalance();
                        }
                    });
            }
        };
    </script>
    
    <!-- Web3.js -->
    <script src="https://cdn.jsdelivr.net/npm/web3@1.7.0/dist/web3.min.js"></script>
</body>
</html>
